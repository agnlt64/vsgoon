<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <style>
        #new-image {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem 0;
            background-color: #d500b9;
            color: #fff;
            outline: none;
            border: 1px solid #fff;
            border-radius: 0.25rem;   
        }

        #new-image:hover {
            background-color: #be01a5;
            cursor: pointer;
        }
    </style>
    <p>Category: <span id="category">${category}</span></p>
    <img src="${imageUrl}" id="goon-image" alt="">
    <button id="new-image">New image</button>
</body>
<script>
    const vscode = acquireVsCodeApi();
    const img = document.getElementById('goon-image');
    const categorySpan = document.getElementById('category');
    const newImageButton = document.getElementById('new-image');

    let refreshDelay = -1;
    let refreshInterval = null;

    newImageButton.addEventListener('click', () => {
        vscode.postMessage({ command: 'requestNewCategory' });
    });

    // Listen for image updates from extension
    window.addEventListener('message', event => {
        const message = event.data;
        if (message.command === 'updateImage') {
            img.src = message.imageUrl;
            categorySpan.textContent = message.category;
            if (message.refreshDelay !== undefined) {
                refreshDelay = message.refreshDelay;
                startAutoRefresh();
            }
        }
    });

    function startAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
            refreshInterval = null;
        }
        if (refreshDelay > 0) {
            refreshInterval = setInterval(() => {
                vscode.postMessage({ command: 'requestNewImage' });
            }, refreshDelay * 1000);
        }
    }
</script>
</html>